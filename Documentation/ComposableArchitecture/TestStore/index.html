<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComposableArchitecture - TestStore</title>
    <link rel="stylesheet" type="text/css" href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/all.css" media="all" />
</head>
<body>
    <header>
        <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture">
            <strong>
                ComposableArchitecture
            </strong>
            <span>Documentation</span>
        </a>
        <sup>Beta</sup>
    </header>

    <!--
    <form class="search">
        <input type="search" placeholder="Search" />
    </form>
    -->

    <nav>
        <div class="wrapper">
            <h2>On This Page</h2>
            <ol><li><a href="#relationships">Relationships</a><ul><li><a href="#relationships">Nested Types</a></li></ul></li><li><a href="#initializers">Initializers</a><ul><li class="initializer"><a href="#teststore.init(initialstate:reducer:environment:state:action:)">init(initial​State:​reducer:​environment:​state:​action:​)</a></li></ul></li><li><a href="#properties">Properties</a><ul><li class="property"><a href="#teststore.environment">environment</a></li><li class="property"><a href="#teststore.fromlocalaction">from​Local​Action</a></li><li class="property"><a href="#teststore.reducer">reducer</a></li><li class="property"><a href="#teststore.state">state</a></li><li class="property"><a href="#teststore.tolocalstate">to​Local​State</a></li></ul></li><li><a href="#methods">Methods</a><ul><li class="method"><a href="#teststore.scope(state:action:)">scope(state:​action:​)</a></li><li class="method"><a href="#teststore.scope(state:)">scope(state:​)</a></li></ul></li></ol>
        </div>
    </nav>

    <main>
        <article>
            <h1>
    <small>Class</small>
    <code class="name">Test​Store</code>
</h1>

<html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="attribute">final</span> <span class="keyword">class</span> <span class="type">TestStore</span>&lt;<span class="variable">State</span>, <span class="variable">LocalState</span>, <span class="variable">Action</span>: <span class="type">Equatable</span>, <span class="variable">LocalAction</span>, <span class="variable">Environment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>A testable runtime for a reducer.</p>

</div>
<div class="discussion">
    <p>For example, given a simple counter reducer:</p>

<html><body><pre class="highlight"><code><span class="keyword">enum</span> <span class="type">CounterAction</span>: <span class="type">Equatable</span> {
  <span class="keyword">case</span> <span class="variable">decrementButtonTapped</span>
  <span class="keyword">case</span> <span class="variable">incrementButtonTapped</span>
}

<span class="keyword">let</span> <span class="variable">counterReducer</span> = <span class="variable">Reducer</span>&lt;<span class="type">Int</span>, <span class="type">CounterAction</span>, <span class="type">Void</span>&gt; { <span class="variable">count</span>, <span class="variable">action</span>, <span class="keyword">_</span> <span class="keyword">in</span>
  <span class="keyword">switch</span> <span class="variable">action</span> {
  <span class="keyword">case</span> .<span class="variable">decrementButtonTapped</span>:
    <span class="type">count</span> -= <span class="number literal">1</span>
    <span class="keyword">return</span> .<span class="variable">none</span>
  <span class="keyword">case</span> .<span class="variable">incrementButtonTapped</span>:
    <span class="type">count</span> += <span class="number literal">1</span>
    <span class="keyword">return</span> .<span class="variable">none</span>
  }
}
</code></pre></body></html>
<p>One can assert against its behavior over time:</p>

<html><body><pre class="highlight"><code><span class="keyword">class</span> <span class="type">CounterTests</span>: <span class="type">XCTestCase</span> {
  <span class="keyword">func</span> <span class="function">testCounter</span>() {
    <span class="keyword">let</span> <span class="variable">store</span> = <span class="variable">TestStore</span>(
      <span class="variable">initialState</span>: <span class="number literal">0</span>,                <span class="comment">// GIVEN counter state of 0</span>
      <span class="variable">reducer</span>: <span class="type">counterReducer</span>,
      <span class="variable">environment</span>: ()
    )

    <span class="variable">store</span>.<span class="type">assert</span>(
      .<span class="variable">send</span>(.<span class="variable">incrementButtonTapped</span>) { <span class="comment">// WHEN the increment button is tapped</span>
        <span class="variable">$0</span> = <span class="number literal">1</span>                        <span class="comment">// THEN the count should be 1</span>
      }
    )
  }
}
</code></pre></body></html>
<p>For a more complex example, including timing and effects, consider the following bare-bones
search feature:</p>

<html><body><pre class="highlight"><code><span class="keyword">struct</span> <span class="type">SearchState</span>: <span class="type">Equatable</span> {
  <span class="keyword">var</span> <span class="variable">query</span> = <span class="string literal">"</span><span class="string literal"/><span class="string literal">"</span>
  <span class="keyword">var</span> <span class="variable">results</span>: [<span class="type">String</span>] = []
}
<span class="keyword">enum</span> <span class="type">SearchAction</span>: <span class="type">Equatable</span> {
  <span class="keyword">case</span> <span class="variable">queryChanged</span>(<span class="type">String</span>)
  <span class="keyword">case</span> <span class="variable">response</span>([<span class="type">String</span>])
}
<span class="keyword">struct</span> <span class="type">SearchEnvironment</span> {
  <span class="keyword">var</span> <span class="variable">mainQueue</span>: <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/AnySchedulerOf"><span class="type">AnySchedulerOf</span></a>&lt;<span class="type">DispatchQueue</span>&gt;
  <span class="keyword">var</span> <span class="variable">request</span>: (<span class="type">String</span>) -&gt; <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/Effect"><span class="type">Effect</span></a>&lt;[<span class="type">String</span>], <span class="type">Never</span>&gt;
}
<span class="keyword">let</span> <span class="variable">searchReducer</span> = <span class="variable">Reducer</span>&lt;
  <span class="type">SearchState</span>, <span class="type">SearchAction</span>, <span class="type">SearchEnvironment</span>
&gt; { <span class="variable">state</span>, <span class="variable">action</span>, <span class="variable">environment</span> <span class="keyword">in</span>

  <span class="comment">// A local identifier for debouncing and canceling the search request effect.</span>
  <span class="keyword">struct</span> <span class="type">SearchId</span>: <span class="type">Hashable</span> {}

  <span class="keyword">switch</span> <span class="variable">action</span> {
  <span class="keyword">case</span> <span class="keyword">let</span> .<span class="variable">queryChanged</span>(<span class="variable">query</span>):
    <span class="type">state</span>.<span class="type">query</span> = <span class="variable">query</span>
    <span class="keyword">return</span> <span class="variable">environment</span>.<span class="type">request</span>(<span class="keyword">self</span>.<span class="type">query</span>)
      .<span class="type">debounce</span>(<span class="variable">id</span>: <span class="type">SearchId</span>(), <span class="variable">for</span>: <span class="number literal">0.5</span>, <span class="variable">scheduler</span>: <span class="type">environment</span>.<span class="type">mainQueue</span>)
  <span class="keyword">case</span> <span class="keyword">let</span> .<span class="variable">response</span>(<span class="variable">results</span>):
    <span class="type">state</span>.<span class="type">results</span> = <span class="variable">results</span>
    <span class="keyword">return</span> .<span class="variable">none</span>
  }
}
</code></pre></body></html>
<p>It can be fully tested by controlling the environment's scheduler and effect:</p>

<html><body><pre class="highlight"><code><span class="comment">// Create a test dispatch scheduler to control the timing of effects</span>
<span class="keyword">let</span> <span class="variable">scheduler</span> = <span class="variable">DispatchQueue</span>.<span class="type">testScheduler</span>

<span class="keyword">let</span> <span class="variable">store</span> = <span class="variable">TestStore</span>(
  <span class="variable">initialState</span>: <span class="type">SearchState</span>(),
  <span class="variable">reducer</span>: <span class="type">searchReducer</span>,
  <span class="variable">environment</span>: <span class="type">SearchEnvironment</span>(
    <span class="comment">// Wrap the test scheduler in a type-erased scheduler</span>
    <span class="variable">mainQueue</span>: <span class="type">scheduler</span>.<span class="type">eraseToAnyScheduler</span>(),
    <span class="comment">// Simulate a search response with one item</span>
    <span class="variable">request</span>: { <span class="keyword">_</span> <span class="keyword">in</span> <span class="variable">Effect</span>(<span class="variable">value</span>: [<span class="string literal">"</span><span class="string literal">Composable Architecture</span><span class="string literal">"</span>]) }
  )
)
<span class="variable">store</span>.<span class="type">assert</span>(
  <span class="comment">// Change the query</span>
  .<span class="variable">send</span>(.<span class="variable">searchFieldChanged</span>(<span class="string literal">"</span><span class="string literal">c</span><span class="string literal">"</span>) {
    <span class="comment">// Assert that state updates accordingly</span>
    <span class="variable">$0</span>.<span class="type">query</span> = <span class="string literal">"</span><span class="string literal">c</span><span class="string literal">"</span>
  },
  <span class="comment">// Advance the scheduler by a period shorter than the debounce</span>
  .<span class="variable">do</span> { <span class="variable">scheduler</span>.<span class="type">advance</span>(<span class="variable">by</span>: <span class="number literal">0.25</span>) },
  <span class="comment">// Change the query again</span>
  .<span class="variable">send</span>(.<span class="variable">searchFieldChanged</span>(<span class="string literal">"</span><span class="string literal">co</span><span class="string literal">"</span>) {
    <span class="variable">$0</span>.<span class="type">query</span> = <span class="string literal">"</span><span class="string literal">co</span><span class="string literal">"</span>
  },
  <span class="comment">// Advance the scheduler by a period shorter than the debounce</span>
  .<span class="variable">do</span> { <span class="variable">scheduler</span>.<span class="type">advance</span>(<span class="variable">by</span>: <span class="number literal">0.25</span>) },
  <span class="comment">// Advance the scheduler to the debounce</span>
  .<span class="variable">do</span> { <span class="variable">scheduler</span>.<span class="type">advance</span>(<span class="variable">by</span>: <span class="number literal">0.25</span>) },
  <span class="comment">// Assert that the expected response is received</span>
  .<span class="variable">receive</span>(.<span class="variable">response</span>([<span class="string literal">"</span><span class="string literal">Composable Architecture</span><span class="string literal">"</span>])) {
    <span class="comment">// Assert that state updates accordingly</span>
    <span class="variable">$0</span>.<span class="type">results</span> = [<span class="string literal">"</span><span class="string literal">Composable Architecture</span><span class="string literal">"</span>]
  }
)
</code></pre></body></html>
</div>
<section id="relationships">
    <h2 hidden>Relationships</h2>
        
        <h3>Nested Types</h3>
<dl>
    <dt class="structure"><code><a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/TestStore_Step">TestStore.Step</a></code></dt>
<dd><p>A single step of a <code>TestStore</code> assertion.</p>
</dd>
</dl>
</section>
    <section id="initializers">
        <h2>Initializers</h2>

        <div role="article" class="initializer" id="teststore.init(initialstate:reducer:environment:state:action:)">
    <h3>
        <code>init(initial​State:​reducer:​environment:​state:​action:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">private</span> <span class="keyword">init</span>(<span class="variable">initialState</span>: <span class="type">State</span>, <span class="variable">reducer</span>: <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">State</span>, <span class="type">Action</span>, <span class="type">Environment</span>&gt;, <span class="variable">environment</span>: <span class="type">Environment</span>, <span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">State</span>) -&gt; <span class="type">LocalState</span>, <span class="variable">action</span> <span class="variable">fromLocalAction</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">LocalAction</span>) -&gt; <span class="type">Action</span>)</code></pre></body></html>
</div>
    </section>
    <section id="properties">
        <h2>Properties</h2>

        <div role="article" class="variable" id="teststore.environment">
    <h3>
        <code>environment</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">var</span> <span class="variable">environment</span>: <span class="type">Environment</span></code></pre></body></html>
</div>
<div role="article" class="variable" id="teststore.fromlocalaction">
    <h3>
        <code>from​Local​Action</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">fromLocalAction</span>: (<span class="type">LocalAction</span>) -&gt; <span class="type">Action</span></code></pre></body></html>
</div>
<div role="article" class="variable" id="teststore.reducer">
    <h3>
        <code>reducer</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">reducer</span>: <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/Reducer"><span class="type">Reducer</span></a>&lt;<span class="type">State</span>, <span class="type">Action</span>, <span class="type">Environment</span>&gt;</code></pre></body></html>
</div>
<div role="article" class="variable" id="teststore.state">
    <h3>
        <code>state</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">var</span> <span class="variable">state</span>: <span class="type">State</span></code></pre></body></html>
</div>
<div role="article" class="variable" id="teststore.tolocalstate">
    <h3>
        <code>to​Local​State</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">toLocalState</span>: (<span class="type">State</span>) -&gt; <span class="type">LocalState</span></code></pre></body></html>
</div>
    </section>
    <section id="methods">
        <h2>Methods</h2>

        <div role="article" class="function" id="teststore.scope(state:action:)">
    <h3>
        <code>scope(state:​action:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">scope</span>&lt;<span class="variable">S</span>, <span class="variable">A</span>&gt;(<span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">LocalState</span>) -&gt; <span class="type">S</span>, <span class="variable">action</span> <span class="variable">fromLocalAction</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">A</span>) -&gt; <span class="type">LocalAction</span>) -&gt; <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/TestStore"><span class="type">TestStore</span></a>&lt;<span class="type">State</span>, <span class="type">S</span>, <span class="type">Action</span>, <span class="type">A</span>, <span class="type">Environment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Scopes a store to assert against more local state and actions.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>to​Local​State</th>
    <td><code class="type">@escaping (Local​State) -&gt; S</code></td></td>
    <td><ul>
<li>toLocalState: A function that transforms the reducer's state into more local state. This state will be asserted against as it is mutated by the reducer. Useful for testing view store state transformations.</li>
</ul>
</td>
</tr>
<tr>
    <th>from​Local​Action</th>
    <td><code class="type">@escaping (A) -&gt; Local​Action</code></td></td>
    <td><ul>
<li>fromLocalAction: A function that wraps a more local action in the reducer's action. Local actions can be &quot;sent&quot; to the store, while any reducer action may be received. Useful for testing view store action transformations.</li>
</ul>
</td>
</tr>
  </tbody>
</table>
</div>
<div role="article" class="function" id="teststore.scope(state:)">
    <h3>
        <code>scope(state:​)</code>
    </h3>
    <html><body><pre class="highlight"><code><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">scope</span>&lt;<span class="variable">S</span>&gt;(<span class="variable">state</span> <span class="variable">toLocalState</span>: <span class="attribute">@</span><span class="attribute">escaping</span> (<span class="type">LocalState</span>) -&gt; <span class="type">S</span>) -&gt; <a href="/Users/brandon/projects/swift-composable-architecture/Documentation/ComposableArchitecture/TestStore"><span class="type">TestStore</span></a>&lt;<span class="type">State</span>, <span class="type">S</span>, <span class="type">Action</span>, <span class="type">LocalAction</span>, <span class="type">Environment</span>&gt;</code></pre></body></html>
<div class="summary" role="doc-abstract">
    <p>Scopes a store to assert against more local state.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>to​Local​State</th>
    <td><code class="type">@escaping (Local​State) -&gt; S</code></td></td>
    <td><ul>
<li>toLocalState: A function that transforms the reducer's state into more local state. This state will be asserted against as it is mutated by the reducer. Useful for testing view store state transformations.</li>
</ul>
</td>
</tr>
  </tbody>
</table>
</div>
    </section>



        </article>
    </main>

    <footer>
        <p>
    Generated on <time datetime="2020-06-03T20:34:10-0700">June 3, 2020</time> using <a href="https://github.com/SwiftDocOrg/swift-doc">swift-doc</a> <span class="version">1.0.0-beta.3</span>.
</p>
    </footer>
</body>
</html>
